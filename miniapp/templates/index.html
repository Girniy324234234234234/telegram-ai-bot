<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sticker Generator</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at top, #1f1f2e, #0b0b12);
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    }

    .app {
      min-height: 100vh;
      padding: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-top: 40px;
    }

    input, button {
      width: 100%;
      max-width: 420px;
      padding: 16px;
      border-radius: 14px;
      border: none;
      margin-bottom: 12px;
      font-size: 16px;
    }

    input {
      background: #111;
      color: #fff;
    }

    button {
      font-weight: 600;
      cursor: pointer;
    }

    .gen {
      background: linear-gradient(135deg, #7b6cff, #9a8cff);
      color: #fff;
    }

    .send {
      background: #2ecc71;
      color: #000;
      display: none;
    }

    .status {
      margin-top: 16px;
      opacity: 0.8;
    }
  </style>
</head>

<body>
<div class="app">

  <h2>üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞</h2>

  <input id="text" placeholder="–ë–æ–±—ë—Ä –≤ —à–∞–ø–∫–µ" />

  <button class="gen" onclick="generate()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
  <button class="send" id="sendBtn" onclick="sendToChat()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç</button>

  <div class="status" id="status"></div>

</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  async function generate() {
    const text = document.getElementById("text").value.trim();
    if (!text) {
      alert("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ");
      return;
    }

    document.getElementById("status").innerText = "‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è...";
    document.getElementById("sendBtn").style.display = "none";

    const res = await fetch("/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: text,
        chat_id: tg.initDataUnsafe.user.id
      })
    });

    const data = await res.json();

    if (!data.ok) {
      document.getElementById("status").innerText = "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏";
      return;
    }

    document.getElementById("status").innerText =
      "‚úÖ –°—Ç–∏–∫–µ—Ä –≥–æ—Ç–æ–≤. –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç.";
    document.getElementById("sendBtn").style.display = "block";
  }

  async function sendToChat() {
    await fetch("/send_to_chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: tg.initDataUnsafe.user.id
      })
    });

    tg.close();
  }
</script>

</body>
</html>

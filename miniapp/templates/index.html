<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Sticker Generator</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <h2>üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞</h2>

  <input id="text" placeholder="–ë–æ–±–µ—Ä –≤ –∫–µ–¥–∞—Ö" />
  <button onclick="generate()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>

  <p id="status"></p>
  <img id="img" style="display:none; max-width:100%" />

<script>
const tg = window.Telegram.WebApp;
tg.expand();

async function generate() {
  const text = document.getElementById("text").value.trim();
  const status = document.getElementById("status");
  const img = document.getElementById("img");

  if (!text) {
    status.innerText = "–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ";
    return;
  }

  status.innerText = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...";
  img.style.display = "none";

  const res = await fetch("/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });

  const data = await res.json();

  if (!data.ok) {
    status.innerText = "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏";
    return;
  }

  img.src = "data:image/png;base64," + data.image;
  img.style.display = "block";
  status.innerText = "–ì–æ—Ç–æ–≤–æ";
}
</script>
</body>
</html>

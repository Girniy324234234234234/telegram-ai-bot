<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sticker Generator</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  background: radial-gradient(800px 400px at top, #1f1f2e, #0b0b12);
  color: #fff;
  font-family: system-ui;
}
.app {
  padding: 24px;
}
input, button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  margin-top: 12px;
  font-size: 16px;
}
button {
  background: linear-gradient(135deg, #7b6cff, #9a8cff);
  color: #fff;
}
img {
  width: 100%;
  margin-top: 16px;
  border-radius: 16px;
  display: none;
}
</style>
</head>

<body>
<div class="app">
  <h2>üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞</h2>
  <input id="text" placeholder="–ö–æ—Ç –≤ —à–∞–ø–∫–µ" />
  <button onclick="generate()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
  <button onclick="sendToChat()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç</button>
  <img id="img"/>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let hasImage = false;

async function generate() {
  const text = document.getElementById("text").value.trim();
  if (!text) return alert("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ");

  const res = await fetch("/generate", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      text: text,
      chat_id: tg.initDataUnsafe.user.id
    })
  });

  const data = await res.json();
  if (!data.ok) return alert("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏");

  const img = document.getElementById("img");
  img.src = "data:image/png;base64," + data.image;
  img.style.display = "block";
  hasImage = true;
}

async function sendToChat() {
  if (!hasImage) return alert("–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Å—Ç–∏–∫–µ—Ä");

  await fetch("/send", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      chat_id: tg.initDataUnsafe.user.id
    })
  });

  tg.close();
}
</script>
</body>
</html>
